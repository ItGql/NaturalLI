<!-- This is only a wrapper for producing JUnit XML output -->
<project name="truth" default="test" basedir=".">
  <property name="tests.path"      value="${basedir}/test/src" />
  <property environment="env"/>
  
  <target name="classpath" description="Sets the classpath">
    <path id="classpath">
      <fileset dir="${basedir}/lib">
        <include name="*.jar"/>
      </fileset>
      <fileset dir="${basedir}/lib/test">
        <include name="*.jar"/>
      </fileset>
      <fileset dir="${basedir}/lib/scripts">
        <include name="*.jar"/>
      </fileset>
      <pathelement path="${basedir}/src/naturalli_client.jar"/>
      <pathelement path="${basedir}/test/test_client.jar"/>
      <pathelement path="${env.SCALA_HOME}/lib/scala-library.jar"/>
      <pathelement path="${env.SCALA_HOME}/lib/scala-xml_2.11-1.0.1.jar"/>
      <!-- JavaNLP -->
      <fileset dir="${env.JAVANLP_HOME}/projects/core/lib">
        <include name="*.jar"/>
      </fileset>
      <pathelement path="${env.JAVANLP_HOME}/projects/core/classes"/>
    </path>
  </target>
  
  <target name="test" depends="classpath"
          description="Run core unit tests">
    <taskdef name="scalatest" classname="org.scalatest.tools.ScalaTestAntTask">
      <classpath refid="classpath"/>
    </taskdef>

    <junit fork="true" maxmemory="1g" printsummary="off" outputtoformatters="false" forkmode="perBatch" haltonfailure="true">
      <classpath refid="classpath"/>
      <formatter type="xml"/>
      <batchtest fork="yes" todir="${basedir}/test/">
        <fileset dir="${tests.path}">
          <include name="**/*Test.java"/>
        </fileset>
      </batchtest>
    </junit>

    <!--
    <scalatest fork="true" maxmemory="2g">
      <runpath>
        <pathelement path="test/test_client.jar" />
      </runpath>
      <reporter type="stdout"/>
      <reporter type="junitxml" directory="${basedir}/test/"/>
    </scalatest>
    -->

  </target>
</project>
