
%
% -----
% The full Finite State Automata over inference states
% -----
%
\newcommand\completeFSA{
  \begin{tikzpicture}[shorten >=1pt,node distance=2.0cm,auto,semithick,inner sep=2pt,bend angle=15,
    % (styles)
    every state/.style={draw=red!100,very thick,fill=red!10},
    accepting/.style={draw=blue!50,very thick,fill=blue!10},
    initial/.style={draw=green!90,very thick,fill=green!10}
    ]

    % (states)
    \node[state,initial]   (equivalent)                             {\equivalent};
    \node[state,accepting] (reverse)    [above right=of equivalent] {\reverse};
    \node[state,accepting] (cover)      [right=of reverse]          {\cover};
    \node[state]           (negate)     [below right=of cover]      {\negate};
    \node[state,initial]   (forward)    [below right=of equivalent] {\forward};
    \node[state]           (alternate)  [right=of forward]          {\alternate};

    % (paths)
    \path[<->] (equivalent) edge              node {\negate}             (negate);
    \path[->]  (negate)     edge [bend right] node {\forward}            (cover)
                            edge [bend left]  node {\alternate}          (reverse)
                            edge [bend left]  node {\reverse}            (alternate)
                            edge [bend right] node {\cover}              (forward)
                            edge [loop right] node {\equivalent}         (negate)
               (reverse)    edge [bend left]  node {\negate\cover}       (cover)
                            edge [loop above] node {\reverse\equivalent} (reverse)
               (cover)      edge [bend left]  node {\negate\alternate}   (reverse)
                            edge [loop above] node {\forward\equivalent} (cover)
               (forward)    edge [bend left] node {\negate\alternate}   (alternate)
                            edge [loop below] node {\forward\equivalent} (forward)
               (alternate)  edge [bend left]  node {\negate\cover}       (forward)
                            edge [loop below] node {\reverse\equivalent} (alternate)
               ;
  \end{tikzpicture}
}

%
% -----
% A Finite State Automata for the collapsed inference states
% -----
%
\newcommand\collapsedFSA{
  \begin{tikzpicture}[shorten >=1pt,node distance=2.0cm,auto,semithick,inner sep=2pt,bend angle=30,
    % (styles)
    every state/.style={draw=red!100,very thick,fill=red!10},
    accepting/.style={draw=blue!50,very thick,fill=blue!10},
    initial/.style={draw=green!90,very thick,fill=green!10}
    ]

    % (states)
    \node[state,initial]   (valid)                               {$~~\varphi \Rightarrow \psi~~$};
    \node[state,accepting] (unknown)    [above right=of valid]   {$~~\varphi \nRightarrow \psi~~$};
    \node[state]           (invalid)    [below right=of unknown] {$\varphi \Rightarrow \lnot \psi$};
    
    % (edges)
    \path[->]  (valid)      edge [bend left]  node {\negate\alternate}   (invalid)
                            edge [bend left]  node {\reverse\cover}      (unknown)
                            edge [loop left]  node {\equivalent\forward} (valid)
               (invalid)    edge [bend left]  node {\negate\cover}       (valid)
                            edge [bend right] node {\alternate\forward}  (unknown)
                            edge [loop right] node {\equivalent\reverse} (invalid)
               (unknown)    edge [loop above] node {any}                 (unknown)
               ;

  \end{tikzpicture}
}

%
% -----
% A Teaser Search Path
% -----
%
\newcommand\teaserSearch{
  \tikzstyle{level 1}=[level distance=1.5cm, sibling distance=3.5cm]
  \tikzstyle{level 2}=[level distance=1.5cm, sibling distance=2cm]
  \tikzstyle{level 3}=[level distance=1.5cm, sibling distance=2cm]
  \tikzstyle{level 4}=[level distance=1.5cm, sibling distance=2cm]
  \tikzstyle{fact} = [text width=7em, text centered]
  \tikzstyle{sink} = [text width=7em, text centered, 
                      rectangle, draw]
  \tikzset{
    goodPath/.style={draw=blue}
  }

  % "No carnivores eat animals"
  % false because: "The cat ate a mouse"

  \begin{tikzpicture}[grow=down, sloped]
  \node[fact] {\w{No carnivores eat animals?}}
    child {
      node[fact] {\w{\textbf{The} carnivores eat animals}} 
      child {
        node[fact] {\w{The \textbf{cat} \\ eats animals}} 
        child {
          node[fact] {\w{The cat \\ ate \textbf{an} animal}}
          child {
            node[sink] {\w{The cat \\ ate a \textbf{mouse}}} 
            edge from parent [goodPath] node[below] {\rotatebox{90}{$\reverse$}}
          }
          edge from parent [goodPath] node[below] {\rotatebox{90}{$\equivalent$}}
        }
        edge from parent [goodPath] node[below] {$\rotatebox{90}{\reverse}$}
      }
      edge from parent [goodPath] node[above] {$\rotatebox{340}{\negate}$}
    }
    child {
      node[fact] {\w{No \textbf{cats} \\ eat animals}} 
      child {
        node[fact] {\w{No cats \\ eat \textbf{mice}}}
          [clockwise from=-50,sibling angle=20]
          child foreach \x in {1,2,3,4} {
            [clockwise from=-55,sibling angle=20]
%            child foreach \x in {1,2,3,4} {}
          }
        edge from parent node[above,shift={(-1 ex,0 ex)}] {$\rotatebox{-56}{\reverse}$}
      }
      child {
        node[fact] {$\dots$}
      }
      edge from parent node[below] {$\rotatebox{90}{\reverse}$}
    }
    child {
      node[fact] {$\dots$}
    };
  \end{tikzpicture}
}

%
% -----
% Teaser Search Paths For Presentation
% -----
%
\def\setstyles{
  \tikzstyle{level 1}=[level distance=1.5cm, sibling distance=3.5cm]
  \tikzstyle{level 2}=[level distance=1.5cm, sibling distance=2cm]
  \tikzstyle{level 3}=[level distance=1.5cm, sibling distance=2cm]
  \tikzstyle{level 4}=[level distance=1.5cm, sibling distance=2cm]
  \tikzstyle{fact} = [text width=7em, text centered, line width=2pt]
  \tikzstyle{boxfact} = [text width=7em, text centered, line width=2pt,
                         rectangle, draw=black, line width=1pt]
  \tikzstyle{shortfact} = [text width=3em, text centered, line width=2pt]
  \tikzstyle{sink} = [text width=7em, text centered, 
                      rectangle, draw=blue, line width=2pt]
  \tikzstyle{unksink} = [text width=7em, text centered, 
                      rectangle, draw=blue]
  \tikzstyle{othersink} = [text width=5em, text centered, 
                      rectangle, draw=blue]
  \tikzset{
    goodPath/.style={draw=blue}
  }
  \tikzset{
    goodPathDown/.style={draw=blue,->}
  }
  \tikzset{
    goodPathUp/.style={draw=blue,<-}
  }
  \tikzset{
    strongPath/.style={draw=blue, line width=3pt}
  }
}

\def\teaserPremises{
  \node[right = of main](db){\includegraphics[height=2.2cm]{../../img/database.png}};
  \node[othersink, right = of main](tails) {\w{All cats have tails}};
  \node[othersink, right = of tails](kittens) {\w{All kittens are cute}};
  \draw (db.north west) -- (main.north west);
  \draw (db.south west) -- (main.south west);
  \draw (db.north east) -- (kittens.north east);
  \draw (db.south east) -- (kittens.south east);
}

\newcommand\teaserManyPremises{
  \setstyles

  \begin{tikzpicture}[grow=down, sloped]
  \node[unksink](main) {\w{The cat ate a mouse}};
  \teaserPremises
  \end{tikzpicture}
}

\newcommand\teaserBlindInferenceNaturalOrderBlind{
  \setstyles

  \begin{tikzpicture}[grow=down, sloped]
  \node[sink](main) {\w{The cat ate a mouse}}
    child {
      node[fact] {$\dots$} 
      child {
        node[fact] {$\dots$} 
        child {
          node[fact] {\includegraphics[height=0.75cm]{../../img/fact.jpg}}
          edge from parent [goodPathDown] node[below] {\rotatebox{90}{}}
        }
        edge from parent [goodPathDown] node[below] {\rotatebox{90}{}}
      }
      edge from parent [goodPathDown] node[below] {\rotatebox{90}{}}
    };
  \teaserPremises
  \end{tikzpicture}
}

\newcommand\teaserBlindInferenceNaturalOrder{
  \setstyles

  \begin{tikzpicture}[grow=down, sloped]
  \node[sink](main) {\w{The cat ate a mouse}}
    child {
      node[fact] {$\dots$} 
      child {
        node[fact] {$\dots$} 
        child {
          node[fact] {\false{No carnivores eat animals}} 
          edge from parent [goodPathDown] node[below] {\rotatebox{90}{}}
        }
        edge from parent [goodPathDown] node[below] {\rotatebox{90}{}}
      }
      edge from parent [goodPathDown] node[below] {\rotatebox{90}{}}
    };
  \teaserPremises
  \end{tikzpicture}
}

\def\glass{\includegraphics[height=0.75cm]{../../img/magnifying_glass.png}}
\newcommand\teaserBlindInference{
  \setstyles

  \begin{tikzpicture}[grow=down, sloped]
  \node[fact](query) {\w{No carnivores eat animals?}}
    child {
      node[fact] {$\dots$} 
      child {
        node[fact] {$\dots$}
        child {
          node[sink](main) {\w{The cat \\ ate a \textbf{mouse}}} 
          edge from parent [goodPathUp] node[below] {}
        }
        edge from parent [goodPathUp] node[below] {}
      }
      edge from parent [goodPathUp] node[below] {}
    };
  \teaserPremises
  \node[right = of query]{\hspace{-1.75cm}\glass};
  \end{tikzpicture}
}

\newcommand\teaserInference{
  \setstyles

  \begin{tikzpicture}[grow=down, sloped]
  \node[fact](query) {\w{No carnivores eat animals?}}
    child {
      node[fact] {\w{\textbf{The} carnivores eat animals}} 
      child {
        node[fact] {\w{The \textbf{cat} \\ eats animals}} 
        child {
          node[fact] {\w{The cat \\ ate \textbf{an} animal}}
          child {
            node[sink](main) {\w{The cat \\ ate a \textbf{mouse}}} 
            edge from parent [goodPath] node[below] {\rotatebox{90}{}}
          }
          edge from parent [goodPath] node[below] {\rotatebox{90}{}}
        }
        edge from parent [goodPath] node[below] {\rotatebox{90}{}}
      }
      edge from parent [goodPath] node[below] {\rotatebox{90}{}}
    };
  \teaserPremises
  \node[right = of query]{\hspace{-1.75cm}\glass};
  \end{tikzpicture}
}

\newcommand\teaserFullDerivation{
  \setstyles

  \begin{tikzpicture}[grow=down, sloped]
  \node[fact](query) {\w{No carnivores eat animals?}}
    child {
      node[fact] {\w{\textbf{The} carnivores eat animals}} 
      child {
        node[fact] {\w{The \textbf{cat} \\ eats animals}} 
        child {
          node[fact] {\w{The cat \\ ate \textbf{an} animal}}
          child {
            node[sink](main) {\w{The cat \\ ate a \textbf{mouse}}} 
            edge from parent [goodPath] node[below] {\rotatebox{90}{}}
          }
          edge from parent [goodPath] node[below] {\rotatebox{90}{}}
        }
        edge from parent [goodPath] node[below] {$\rotatebox{90}{}$}
      }
      edge from parent [goodPath] node[above] {$\rotatebox{340}{}$}
    }
    child {
      node[fact] {$\dots$} 
      child {
        node[fact] {$\dots$}
          [clockwise from=-50,sibling angle=20]
          child foreach \x in {1,2,3,4} {
            [clockwise from=-55,sibling angle=20]
%            child foreach \x in {1,2,3,4} {}
          }
        edge from parent node[above,shift={(-1 ex,0 ex)}] {}
      }
      child {
        node[shortfact] {$\dots$}
      }
      edge from parent node[below] {$\rotatebox{90}{}$}
    }
    child {
      node[shortfact] {$\dots$}
    };
  \teaserPremises
  \node[right = of query]{\hspace{-1.75cm}\glass};
  \end{tikzpicture}
}

%
% -----
% The MacCartney Relations (as Venn Diagrams)
% -----
%
\definecolor{light}{rgb}{.926,.969,.691}
\definecolor{dark}{rgb}{.5,.801,.730}
%\definecolor{dark}{rgb}{.172,.5,.719}
\newcommand\frameVenn{
  \draw (-1,-1) rectangle (1,1);
  \draw (0.8,0.8) node {$\ensuremath{\mathcal{D}}$};
}
\newcommand\relName[1]{
  \draw (0, -1.8) node {\small{(\textit{#1})}};
}

\newcommand\equivalentVenn{
  \begin{tikzpicture}
    \def\vennA{(0.0,0.0) circle (0.5)}
    \def\vennB{(0.0,0.0) circle (0.49)}

    \draw \vennB node [below] {};
    \draw \vennA node [above] {};
    
    \begin{scope}
      \fill[fill=light] \vennA;
    \end{scope}
    \begin{scope}
      \fill[pattern=north west lines, pattern color=dark] \vennB;
    \end{scope}
    
    \frameVenn
    \draw (0, -1.3) node {$\varphi \equivalent \psi$};
    \relName{equivalence}
  \end{tikzpicture}
}

\newcommand\forwardVenn{
  \begin{tikzpicture}
    \def\vennA{(-0.1,-0.1) circle (0.2)}
    \def\vennB{(-0.0,-0.0) circle (0.5)}

    \draw \vennB node [below] {};
    \draw \vennA node [above] {};
    \begin{scope}
      \fill[fill=light] \vennB;
    \end{scope}
    \begin{scope}
      \fill[fill=dark] \vennA;
    \end{scope}
    
    \frameVenn
    \draw (0, -1.3) node {$\varphi \forward \psi$};
    \relName{forward entail.}
  \end{tikzpicture}
}

\newcommand\reverseVenn{
  \begin{tikzpicture}
    \def\vennA{(-0.1,-0.1) circle (0.2)}
    \def\vennB{(0.0,0.0) circle (0.5)}
    
    \draw \vennB node [below] {};
    \draw \vennA node [above] {};
    \begin{scope}
      \fill[fill=dark] \vennB;
    \end{scope}
    \begin{scope}
      \fill[fill=light] \vennA;
    \end{scope}
    
    \frameVenn
    \draw (0, -1.3) node {$\varphi \reverse \psi$};
    \relName{reverse entail.}
  \end{tikzpicture}
}

\newcommand\negateVenn{
  \begin{tikzpicture}
    \def\vennA{(0,-1) rectangle (1,1)}
    \def\vennB{(-1,-1) rectangle (0,1)}
    
    \draw \vennB node [below] {};
    \draw \vennA node [above] {};
    \begin{scope}
      \fill[fill=dark] \vennB;
    \end{scope}
    \begin{scope}
      \fill[fill=light] \vennA;
    \end{scope}
    
    \frameVenn
    \draw (0, -1.3) node {$\varphi \negate \psi$};
    \relName{negation}
  \end{tikzpicture}
}

\newcommand\alternateVenn{
  \begin{tikzpicture}
    \def\vennA{(-0.4,0.4) circle (0.5)}
    \def\vennB{(0.4,-0.4) circle (0.5)}
    
    \draw \vennB node [below] {};
    \draw \vennA node [above] {};
    \begin{scope}
      \fill[fill=dark] \vennB;
    \end{scope}
    \begin{scope}
      \fill[fill=light] \vennA;
    \end{scope}
    
    \frameVenn
    \draw (0, -1.3) node {$\varphi \alternate \psi$};
    \relName{alternation}
  \end{tikzpicture}
}

\newcommand\coverVenn{
  \begin{tikzpicture}
    \def\vennA{(-0.2,-1) rectangle (1,1)}
    \def\vennB{(-1,-1) rectangle (0.2,1)}
    
    \draw \vennB node [below] {};
    \draw \vennA node [above] {};
    \begin{scope}
      \fill[fill=dark] \vennB;
    \end{scope}
    \begin{scope}
      \fill[fill=light] \vennA;
    \end{scope}
    \begin{scope}
      \clip \vennA;
      \fill[pattern=north west lines, pattern color=dark] \vennB;
    \end{scope}
    
    \frameVenn
    \draw (0, -1.3) node {$\varphi \cover \psi$};
    \relName{cover}
  \end{tikzpicture}
}


%
% -----
% NatLog Monotonicity
% -----
%
\def\monoHeader{
  \begin{tikzpicture}[node distance=0cm,
                      start chain=going below,
                      punktchain/.style={
                        rectangle, 
                        rounded corners, 
                        draw=black, very thick,
                        text width=6em, 
                        minimum height=2em, 
                        text centered, 
                        on chain},
                      black/.style={
                        text width=6em, 
                        minimum height=3.25ex, 
                        text centered, 
                        text=black,
                        on chain},
                      gray/.style={
                        text width=6em, 
                        minimum height=3.25ex, 
                        text centered, 
                        text=gray,
                        on chain},
                      ]
}
\newcommand\monoUp[4]{
  \monoHeader
    \node[black]{#4};
    \node[black]{#3};
    \node[punktchain, color=blue]{$\uparrow$ #2};
    \node[gray]{#1};
  \end{tikzpicture}
}

\newcommand\monoDown[4]{
  \monoHeader
    \node[gray]{#4};
    \node[gray]{#3};
    \node[punktchain, color=blue]{$\downarrow$ #2};
    \node[black]{#1};
  \end{tikzpicture}
}

\newcommand\monoUpR[4]{
  \monoHeader
    \node[gray]{#4};
    \node[gray]{#3};
    \node[punktchain, color=blue]{$\uparrow$ #2};
    \node[black]{#1};
  \end{tikzpicture}
}

\newcommand\monoDownR[4]{
  \monoHeader
    \node[black]{#4};
    \node[black]{#3};
    \node[punktchain, color=blue]{$\downarrow$ #2};
    \node[gray]{#1};
  \end{tikzpicture}
}

\newcommand\monoFlat[4]{
  \monoHeader
    \node[gray]{#4};
    \node[gray]{#3};
    \node[punktchain, color=blue]{$---$ #2};
    \node[gray]{#1};
  \end{tikzpicture}
}

%
% -----
% Graph Fragments
% -----
%

\newcommand\exampleTreeImpl[5]{
  \setstyles
  \tikzstyle{level 2}=[level distance=1.5cm, sibling distance=3.5cm]
  \begin{tikzpicture}[grow=down, sloped]
    \node[fact] {\w{\gray{#1}}}
    child {
      node[boxfact] {\w{#2?}}
        child {
          node[#5] {\w{#3}} 
          edge from parent [strongPath] node[above] {}
        }
        child {
          node[fact] {\w{#4}} 
        }
        child {
          node[fact] {$\dots$}
        }
    };
  \end{tikzpicture}
}
\newcommand\exampleTree[4]{\exampleTreeImpl{#1}{#2}{#3}{#4}{fact}}
\newcommand\exampleTreeEnd[4]{\exampleTreeImpl{#1}{#2}{#3}{#4}{sink}}

\def\exampleStepOne{\exampleTree{ROOT \\ $~$}
                                {No carnivores eat animals}
                                {\textbf{The} carnivores eat animals}
                                {No \textbf{cats} eat animals}}
\def\exampleStepTwo{\exampleTree{No carnivores eat animals}
                                {The carnivores eat animals}
                                {The \textbf{feline} eats animals}
                                {\textbf{All} carnivores eat animals}}
\def\exampleStepThree{\exampleTree{The carnivores eat animals}
                                  {The feline eats animals}
                                  {The \textbf{cat} eats animals}
                                  {The cat eats \textbf{chordate}}}
\def\exampleStepFour{\exampleTree{The feline eats animals}
                                 {The cat eats animals}
                                 {The cat eats \textbf{chordates}}
                                 {The \textbf{kitty} eats animals}}
\def\exampleStepFive{\exampleTree{The cat eats animals}
                                 {The cat eats chordates}
                                 {The cat eats \textbf{mice}}
                                 {The cat eats \textbf{dogs}}}
\def\exampleStepSix{\exampleTreeEnd{The cat eats chordates}
                                   {The cat eats mice}
                                   {The cat ate \textbf{a} mouse}
                                   {The \textbf{kitty} eats mice}}
\def\exampleStepEnd{
  \setstyles
  \begin{tikzpicture}[grow=down, sloped]
  \node[sink](main) {\w{The cat ate a mouse}};
  \end{tikzpicture}
}

\def\exampleInsertions{\exampleTree{The cat eats chordates}
                                   {The cat ate mouse?}
                                   {The cat ate \textbf{a} mouse}
                                   {The cat ate \textbf{catnip} mice}}

%
% -----
% Fact Trie
% -----
%
\def\settriestyles{
  \tikzstyle{level 1}=[level distance=2.5cm, sibling distance=2.0cm]
  \tikzstyle{level 2}=[level distance=2.5cm, sibling distance=2.0cm]
  \tikzstyle{level 3}=[level distance=2.5cm, sibling distance=2.0cm]
  \tikzstyle{level 4}=[level distance=2.5cm, sibling distance=2.0cm]
  \tikzstyle{trie} = [text width=1em, text centered]
  \tikzstyle{sink} = [text width=7em, text centered, 
                      rectangle, draw=blue]
  \tikzstyle{othersink} = [text width=5em, text centered, 
                      rectangle, draw=blue]
  \tikzset{
    goodPath/.style={draw=blue}
  }
  \tikzset{
    path/.style={draw=black, line width=1pt}
  }
  \tikzset{
    strongPath/.style={draw=blue, line width=3pt}
  }
  \tikzset{
    dotpath/.style={draw=black, line width=1pt, dashed}
  }
}

\newcommand\factTrie[3]{
\begin{tikzpicture}[grow=right, sloped]
  \settriestyles
  \def\dot{\Huge{\ensuremath{\cdot}}}

  \node[trie] {\dot}
    child {
      node[trie] {\dot} 
      edge from parent [path] node[above] {\w{Socrates}}
    }
    child {
      node[trie] {\dot} 
      child {
        node[trie] {\dot} 
        edge from parent [path] node[above] {\w{fish}}
      }
      child {
        node[trie] {\dot} 
        child {
          node[trie] {\dot} 
          edge from parent [path] node[above] {\w{sleeps}}
        }
        child {
          node[trie] {\dot} 
          edge from parent [path] node[above] {\w{likes}}
        }
        child {
          node[trie] {\dot}
            child {
              node[trie] {\dot} 
              edge from parent [#3] node[above] {\w{a}}
            }
            child {
              node[trie] {\dot} 
              edge from parent [#2] node[above] {\w{my}}
            }
            child {
              node[trie] {\dot}
              edge from parent [#1] node[above] {\w{catnip}}
            }
          edge from parent [strongPath] node[above] {\w{ate}}
        }
        edge from parent [strongPath] node[above] {\w{cat}}
      }
      child {
        node[trie] {\dot}
        edge from parent [path] node[above] {\w{economist}}
      }
      edge from parent [strongPath] node[above] {\w{The}};
    }
    child {
      node[trie] {\dot}
      edge from parent [path] node[above] {\w{All}}
    };

\end{tikzpicture}
}


%
% -----
% Lattice
% -----
%
\newcommand\lattice{
\begin{tikzpicture}[->,>=stealth,shorten >=1pt,auto,node distance=1.1cm,
                    semithick]
  \node[] (top)                            {$\top$};
  \node[] (animal) [below of=top]          {\w{animal}};
  \node[] (feline) [below left of=animal]  {\w{feline}};
  \node[] (cat)    [below of=feline]       {\w{cat}};
  \node[] (dog)    [below right of=animal] {\w{dog}};
  \node[] (bot)    [below right of=cat]    {$\bot$};

  \path (animal) edge (top)
        (feline) edge (animal)
        (cat)    edge (feline)
        (dog)    edge (animal)
        (bot)    edge (cat)
                 edge (dog);

\end{tikzpicture}
}


